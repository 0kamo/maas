<header class="page-header margin-bottom" data-maas-sticky-header>
    <div class="inner-wrapper">
        <h1 class="page-header__title eight-col">{$ subnet.cidr $}</h1>
        <div data-ng-hide="loaded">
            <div class="inner-wrapper">
                <h1 class="page-header__title twelve-col">Loading...</h1>
            </div>
        </div>
        <div class="page-header__actions ng-hide" data-ng-show="isSuperUser() && !isDefaultSubnet() && !loading">
            <div class="right no-margin-bottom last-col">
                <button class="cta-ubuntu"
                    data-ng-click="deleteButton()"
                    data-ng-hide="confirmingDelete">Delete subnet</button>
            </div>
        </div>
        <div class="page-header__dropdown ng-hide" data-ng-show="confirmingDelete">
            <div class="page-header__feedback ng-hide" data-ng-show="!error">
                <p class="page-header__feedback-message error">
                    Are you sure you want to delete this subnet and release all
                    IP addresses assigned within its range?
                </p>
                <div class="right">
                    <a href="" class="margin-right" data-ng-click="cancelDeleteButton()">Cancel</a>
                    <button class="cta-ubuntu" data-ng-click="deleteConfirmButton()">Go</button>
                </div>
            </div>
            <div class="page-header__feedback ng-hide" data-ng-show="error">
                <p class="page-header__feedback-message error">
                    {$ error $}
                </p>
                <div class="right">
                    <a href="" class="margin-right" data-ng-click="cancelDeleteButton()">Cancel</a>
                    <button class="cta-ubuntu" data-ng-click="deleteConfirmButton()">Retry</button>
                </div>
            </div>
        </div>
    </div>
</header>
<div data-ng-if="loaded">
    <section class="row">
        <div class="inner-wrapper">
            <div class="tweleve-col">
                <h2>Subnet summary</h2>
            </div>
            <maas-obj-form obj="subnet" manager="subnetManager" pre-process="subnetPreSave">
                <fieldset class="six-col form">
                    <maas-obj-field type="text" key="name" label="Name" placeholder="Subnet name"
                        label-width="two" input-width="three" blur-on-enter="true"></maas-obj-field>
                    <maas-obj-field-group>
                        <maas-obj-field type="text" key="cidr" label="CIDR" placeholder="Subnet CIDR"
                            label-width="two" input-width="three" blur-on-enter="true"></maas-obj-field>
                        <maas-obj-field type="text" key="gateway_ip" label="Gateway IP" placeholder="Gateway IP"
                            label-width="two" input-width="three" blur-on-enter="true"></maas-obj-field>
                    </maas-obj-field-group>
                    <maas-obj-field type="text" key="dns_servers" label="DNS" placeholder="DNS nameservers for subnet"
                        label-width="two" input-width="three" blur-on-enter="true"></maas-obj-field>
                    <maas-obj-field type="textarea" key="description" label="Description" placeholder="Subnet description"
                        label-width="two" input-width="three" blur-on-enter="true"></maas-obj-field>
                </fieldset>
                <fieldset class="six-col last-col">
                    <maas-obj-field type="options" key="fabric" label="Fabric" placeholder="Choose fabric"
                        options="fabric.id as fabric.name for fabric in fabrics | orderBy:'name'"
                        label-width="two" input-width="three"></maas-obj-field>
                    <maas-obj-field type="options" key="vlan" label="VLAN" placeholder="Choose VLAN"
                        options="v.id as getVLANName(v) for v in vlans | filterByFabric:subnet.fabric"
                        label-width="two" input-width="three"></maas-obj-field>
                    <maas-obj-field type="options" key="space" label="Space" placeholder="Choose space"
                        options="space.id as space.name for space in spaces"
                        label-width="two" input-width="three"></maas-obj-field>
                </fieldset>
            </maas-obj-form>
        </div>
    </section>
    <section class="row">
        <div class="inner-wrapper">
            <div class="tweleve-col">
                <h2>Utilisation</h2>
            </div>
            <div class="equal-height">
                <div class="six-col">
                    <dl class="six-col">
                        <dt class="two-col">Subnet addresses</dt>
                            <dd class="four-col last-col">{$ subnet.statistics.total_addresses $}</dd>
                        <dt class="two-col">Availability</dt>
                            <dd class="four-col last-col">{$ subnet.statistics.num_available $} ({$ subnet.statistics.available_string $})</dd>
                    </dl>
                </div>
                <div class="six-col last-col">
                    <dl class="six-col">
                        <!-- XXX mpontillo we don't have data for "Reserved" yet. -->
                        <dt class="two-col ng-hide">Reserved</dt>
                            <dd class="four-col last-col ng-hide">10%</dd>
                        <dt class="two-col">Used</dt>
                            <dd class="four-col last-col">{$ subnet.statistics.usage_string $}</dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="inner-wrapper">
            <div class="tweleve-col">
                <h2>Reserved</h2>
            </div>
            <div class="tweleve-col padding-bottom">
                <div class="table margin-bottom">
                    <header class="table__head">
                        <div class="table__row">
                            <div class="table__header table-col--15">Start IP Address</div>
                            <div class="table__header table-col--15">End IP Address</div>
                            <div class="table__header table-col--10 ng-hide">Amount</div>
                            <div class="table__header table-col--10 ng-hide">Used</div>
                            <div class="table__header table-col--10">Owner</div>
                            <div class="table__header table-col--40">Purpose</div>
                        </div>
                    </header>
                    <main class="table__body">
                        <div class="table__row" data-ng-repeat="iprange in ipranges | filterBySubnet:subnet">
                            <div class="table__data table-col--15">{$ iprange.start_ip $}</div>
                            <div class="table__data table-col--15">{$ iprange.end_ip $}</div>
                            <!-- XXX mpontillo need amount, usage% -->
                            <div class="table__data table-col--10 ng-hide">100</div>
                            <div class="table__data table-col--10 ng-hide">54%</div>
                            <div class="table__data table-col--10">{$ iprange.type == "dynamic" ? "MAAS" : iprange.user $}</div>
                            <div class="table__data table-col--34">{$ iprange.type == "dynamic" ? "Dynamic" : "Reserved: " + iprange.comment$}</div>
                            <!-- XXX mpontillo need to implement edit mode -->
                            <div class="table__data table-col--6 ng-hide">
                                <div class="table__controls align-right">
                                    <a class="icon edit"></a>
                                    <a class="icon delete"></a>
                                </div>
                            </div>
                        </div>
                        <!-- XXX mpontillo editing examples commented out for now -->
                        <!--
                        <div class="table__row active">
                            <div class="table__data table-col--15">172.168.10.131</div>
                            <div class="table__data table-col--15">172.168.10.140</div>
                            <div class="table__data table-col--10">9</div>
                            <div class="table__data table-col--10"><a href="#">54%</a></div>
                            <div class="table__data table-col--10">mark</div>
                            <div class="table__data table-col--34">Dynamic</div>
                            <div class="table__data table-col--6">
                                <div class="table__controls align-right">
                                    <a class="icon edit"></a>
                                    <a class="icon delete"></a>
                                </div>
                            </div>
                            <div class="table__dropdown">
                                <div class="table__row table__dropdown-row active">
                                    <div class="table__data table-col--50">
                                        <div class="six-col inline">
                                            <label class="two-col" for="start-ip">Start IP address</label>
                                            <input class="three-col last-col" type="text" id="start-ip" placeholder="127.0.0.1" value="172.168.10.131">
                                        </div>
                                        <div class="six-col inline">
                                            <label class="two-col" for="addresses">Number of addresses</label>
                                            <input class="three-col last-col" type="text" id="addresses" placeholder="100" value="9">
                                        </div>
                                    </div>
                                    <div class="table__data table-col--50">
                                        <div class="six-col inline">
                                            <label class="two-col" for="end-ip">End IP address</label>
                                            <input class="three-col last-col" type="text" id="end-ip" placeholder="127.0.0.1" value="172.168.10.140">
                                        </div>
                                        <div class="six-col inline">
                                            <label class="two-col" for="purpose">Purpose</label>
                                            <input class="three-col last-col" type="text" id="purpose" placeholder="OpenStack cloud" value="Dynamic">
                                        </div>
                                    </div>
                                </div>
                                <div class="table__row table__dropdown-row active">
                                    <div class="table__data right">
                                        <a class="link-cta-ubuntu text-button">Cancel</a>
                                        <button class="cta-ubuntu">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table__row">
                            <div class="table__data table-col--15">172.168.10.141</div>
                            <div class="table__data table-col--15">172.168.10.189</div>
                            <div class="table__data table-col--10">39</div>
                            <div class="table__data table-col--10"><a href="#">4%</a></div>
                            <div class="table__data table-col--10">mark</div>
                            <div class="table__data table-col--34">Dynamic</div>
                            <div class="table__data table-col--6">
                                <div class="table__controls align-right">
                                    <a class="icon edit"></a>
                                    <a class="icon delete"></a>
                                </div>
                            </div>
                        </div>
                        <div class="table__row active">
                            <div class="table__data table-col--50">
                                <div class="six-col inline">
                                    <label class="two-col" for="start-ip">Start IP address</label>
                                    <input class="three-col last-col" type="text" id="start-ip" placeholder="127.0.0.1">
                                </div>
                                <div class="six-col inline">
                                    <label class="two-col" for="addresses">Number of addresses</label>
                                    <input class="three-col last-col" type="text" id="addresses" placeholder="100">
                                </div>
                            </div>
                            <div class="table__data table-col--50">
                                <div class="six-col inline">
                                    <label class="two-col" for="end-ip">End IP address</label>
                                    <input class="three-col last-col" type="text" id="end-ip" placeholder="127.0.0.1">
                                </div>
                                <div class="six-col inline">
                                    <label class="two-col" for="purpose">Purpose</label>
                                    <input class="three-col last-col" type="text" id="purpose" placeholder="OpenStack cloud">
                                </div>
                            </div>
                            <div class="table__dropdown">
                                <div class="table__row table__dropdown-row active">
                                    <div class="table__data right">
                                        <a class="link-cta-ubuntu text-button">Cancel</a>
                                        <button class="cta-ubuntu">Reserve</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        -->
                    </main>
                </div>
            </div>
            <div class="tweleve-col">
                <div class="six-col">
                    <h2>Used</h2>
                </div>
                <div class="six-col last-col">
                    <div class="search ng-hide">
                        <input placeholder="Search IP addresses" class="search__input" type="search">
                        <input class="search__submit" type="submit">
                    </div>
                </div>
            </div>
            <div class="tweleve-col">
                <table class="table-listing">
                    <thead>
                        <tr class="table-listing__row">
                            <th class="table-listing__header table-col--20">IP Address</th>
                            <th class="table-listing__header table-col--10">Type</th>
                            <th class="table-listing__header table-col--15">Node</th>
                            <th class="table-listing__header table-col--10">Interface</th>
                            <th class="table-listing__header table-col--10">Usage</th>
                            <th class="table-listing__header table-col--10">Owner</th>
                            <th class="table-listing__header table-col--25">Last seen</th>
                            <!-- XXX mpontillo need data for this -->
                            <!--
                            <th class="table-listing__header table-col--25" colspan="2">
                                <a class="table-listing__header-link" href="#">Purpose</a>
                                <span class="divide"></span>
                                <a class="table-listing__header-link active" href="#">Last seen</a>
                                <span class="divide"></span>
                                <a  class="table-listing__header-link" href="#">Detected</a>
                            </th>
                            -->
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ng-repeat="ip in subnet.ip_addresses">
                            <td class="table-col--20">{$ ip.ip $}</td>
                            <td class="table-col--10" data-ng-switch="ip.alloc_type">
                                <span data-ng-switch-when="0">Automatic</span>
                                <span data-ng-switch-when="1">Static</span>
                                <span data-ng-switch-when="4">User reserved</span>
                                <span data-ng-switch-when="5">DHCP</span>
                                <span data-ng-switch-when="6">Observed</span>
                                <span data-ng-switch-default>Unknown</span>
                            </td>
                            <td class="table-col--15" data-ng-switch="ip.node_summary.node_type">
                                <span data-ng-switch-when="0"><a href="#/node/{$ ip.node_summary.system_id $}">{$ ip.node_summary.hostname $}</a></span>
                                <span data-ng-switch-when="1">{$ ip.node_summary.hostname $}</span>
                                <span data-ng-switch-when="2"><a href="#/node/controller/{$ ip.node_summary.system_id $}">{$ ip.node_summary.hostname $}</a></span>
                                <span data-ng-switch-when="3"><a href="#/node/controller/{$ ip.node_summary.system_id $}">{$ ip.node_summary.hostname $}</a></span>
                                <span data-ng-switch-when="4"><a href="#/node/controller/{$ ip.node_summary.system_id $}">{$ ip.node_summary.hostname $}</a></span>
                            </td>
                            <td class="table-col--10" data-ng-switch="ip.node_summary.node_type">
                                <span data-ng-switch-when="0">{$ ip.node_summary.via $}</span>
                                <span data-ng-switch-when="1">{$ ip.node_summary.via $}</span>
                                <span data-ng-switch-when="2">{$ ip.node_summary.via $}</span>
                                <span data-ng-switch-when="3">{$ ip.node_summary.via $}</span>
                                <span data-ng-switch-when="4">{$ ip.node_summary.via $}</span>
                                <span data-ng-switch-default>Unknown</span>
                            </td>
                            <td class="table-col--10" data-ng-switch="ip.node_summary.node_type">
                                <span data-ng-switch-when="0">Machine</span>
                                <span data-ng-switch-when="1">Device</span>
                                <span data-ng-switch-when="2">Rack controller</span>
                                <span data-ng-switch-when="3">Region controller</span>
                                <span data-ng-switch-when="4">Rack and region controller</span>
                                <span data-ng-switch-default>Unknown</span>
                            </td>
                            <td class="table-col--10">{$ ip.user ? ip.user : "MAAS" $}</td>
                            <td class="table-col--25">
                                <time>{$ ip.updated $}</time>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</div>
