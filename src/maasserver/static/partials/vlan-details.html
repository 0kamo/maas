<div data-ng-hide="loaded">
    <header class="page-header">
        <div class="inner-wrapper">
            <h1 class="page-header__title twelve-col">Loading...</h1>
        </div>
    </header>
</div>
<div data-ng-if="vlanDetails.loaded">
    <header class="page-header" data-maas-sticky-header>
        <div class="inner-wrapper">
            <h1 class="page-header__title twelvel-col">
                {$ vlanDetails.title $}
            </h1>
            <!-- "Take action" dropdown -->
            <div data-ng-show="vlanDetails.actionOptions.length">
                <div class="page-header__actions four-col last-col">
                     <div class="page-header__cta three-col no-margin-bottom last-col">
                        <div class="three-col no-margin-bottom last-col">
                            <div data-maas-cta="vlanDetails.actionOptions"
                                data-ng-model="vlanDetails.actionOption"
                                data-ng-change="vlanDetails.actionOptionChanged()">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-header__dropdown ng-hide" data-ng-show="vlanDetails.actionOption">
                    <div class="page-header__feedback ng-hide" data-ng-hide="vlanDetails.isActionError()">
                        <form class="tweleve-col">
                            <div class="tweleve-col clearfix border-bottom margin-bottom padding-bottom" data-ng-show="vlanDetails.actionOption.name === 'provide_dhcp'">
                                <fieldset class="six-col no-padding no-margin-bottom">
                                    <div class="inline" data-ng-hide="vlanDetails.relatedSubnets.length === 0">
                                        <label for="primary-rack" class="two-col">Primary controller</label>
                                        <select name="primary-rack" class="three-col" data-ng-model="vlanDetails.provideDHCPAction.primaryRack" data-ng-change="vlanDetails.updatePrimaryRack()" data-ng-options="rack.system_id as rack.hostname for rack in vlanDetails.relatedControllers">
                                            <!-- XXX mpontillo temporary hack: remove this when we have a better way to disable DHCP. -->
                                            <option value="" disabled="disabled" selected="selected">Choose primary controller</option>
                                            <option value=""></option>
                                        </select>
                                    </div>
                                    <div class="inline" data-ng-hide="vlanDetails.relatedSubnets.length === 0">
                                        <label for="secondary-rack" class="two-col">Secondary controller</label>
                                        <select name="secondary-rack" class="three-col" data-ng-model="vlanDetails.provideDHCPAction.secondaryRack" data-ng-change="vlanDetails.updateSecondaryRack()" data-ng-options="rack.system_id as rack.hostname for rack in vlanDetails.relatedControllers">
                                            <option value="" disabled="disabled" selected="selected">Choose secondary controller</option>
                                            <option value=""></option>
                                        </select>
                                    </div>
                                    <div class="inline" data-ng-hide="vlanDetails.relatedSubnets.length === 0 || (vlanDetails.provideDHCPAction.needsDynamicRange === false && vlanDetails.provideDHCPAction.needsGatewayIP === false)">
                                        <label for="subnet" class="two-col">Subnet</label>
                                        <select name="subnet" class="three-col" data-ng-model="vlanDetails.provideDHCPAction.subnet" data-ng-change="vlanDetails.updateSubnet()" data-ng-options="row.subnet.id as row.subnet.cidr for row in vlanDetails.relatedSubnets">
                                            <option value="" disabled="disabled" selected="selected">Choose subnet</option>
                                            <option value=""></option>
                                        </select>
                                   </div>
                                </fieldset>
                                <fieldset class="six-col last-col no-padding no-margin-bottom">
                                    <div class="inline" data-ng-hide="vlanDetails.provideDHCPAction.needsDynamicRange === false || vlanDetails.relatedSubnets.length === 0">
                                        <label for="start-ip" class="two-col">Start IP</label>
                                        <input type="text" name="start-ip" size="39" class="three-col" placeholder="192.168.0.1" data-ng-model="vlanDetails.provideDHCPAction.startIP" data-ng-disabled="!vlanDetails.provideDHCPAction.subnet" data-ng-change="vlanDetails.updateStartIP()">
                                    </div>
                                    <div class="inline" data-ng-hide="vlanDetails.provideDHCPAction.needsDynamicRange === false || vlanDetails.relatedSubnets.length === 0">
                                        <label for="end-ip" class="two-col">End IP</label>
                                        <input type="text" name="end-ip" size="39" class="three-col" placeholder="192.168.0.10" data-ng-model="vlanDetails.provideDHCPAction.endIP" data-ng-disabled="!vlanDetails.provideDHCPAction.subnet" data-ng-change="vlanDetails.updateEndIP()">
                                    </div>
                                    <div class="inline" data-ng-hide="vlanDetails.provideDHCPAction.needsGatewayIP === false || vlanDetails.provideDHCPAction.subnetMissingGatewayIP === false || vlanDetails.relatedSubnets.length === 0">
                                        <label for="gateway-ip" class="two-col">Gateway IP</label>
                                        <input type="text" name="gateway-ip" size="39" class="three-col" placeholder="0.0.0.0" data-ng-model="vlanDetails.provideDHCPAction.gatewayIP" data-ng-disabled="!vlanDetails.provideDHCPAction.subnet" data-ng-change="vlanDetails.updatendIP()">
                                    </div>
                                    <!-- IP range selection fields -->
                                        <!--
                                        <div class="inline">
                                            <label for="number-of-ips" class="two-col">Maximum addresses</label>
                                            <input type="text" class="three-col" name="number-of-ips" data-ng-model="vlanDetails.provideDHCPAction.numIPs" data-ng-disabled="true" data-ng-change="vlanDetails.updateNumAddresses()">
                                        </div>
                                        -->
                                </fieldset>
                            </div>
                            <div class="form-inline">
                                <div class="right">
                                    <a href="" class="margin-right" data-ng-click="vlanDetails.actionCancel()">Cancel</a>
                                    <button class="cta-ubuntu" data-ng-click="vlanDetails.actionGo()" data-ng-disabled="vlanDetails.actionOption.name === 'provide_dhcp' && vlanDetails.relatedSubnets.length === 0">Go</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="page-header__feedback ng-hide" data-ng-show="vlanDetails.actionOption.name === 'provide_dhcp' && vlanDetails.relatedSubnets.length === 0">
                        <p class="page-header__feedback-message info">
                            No subnets are available on this VLAN. DHCP cannot be enabled.
                        </p>
                    </div>
                    <div class="page-header__feedback ng-hide" data-ng-show="vlanDetails.isActionError()">
                        <p class="page-header__feedback-message info">
                            {$ vlanDetails.actionError $}
                        </p>
                        <div class="right">
                            <a href="" class="margin-right" data-ng-click="vlanDetails.actionCancel()">Cancel</a>
                            <button class="cta-ubuntu" data-ng-click="vlanDetails.actionRetry()">Retry</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of "Take action" dropdown -->
        </div>
    </header>
    <section class="row">
        <div class="inner-wrapper">
            <h2>VLAN Summary</h2>
           <dl class="six-col">
                <!-- The user can't change the VID of the default VLAN. -->
               <div class="ng-hide" data-ng-show="vlanDetails.vlan.vid">
                   <dt class="two-col">VID</dt><dd class="four-col last-col">{$ vlanDetails.vlan.vid $}</dd>
               </div>
               <div class="ng-hide" data-ng-show="vlanDetails.vlan.name">
                   <!-- XXX mpontillo: when we support editing, this needs to have placeholder text if it's empty. -->
                   <dt class="two-col">Name</dt><dd class="four-col last-col">{$ vlanDetails.vlan.name $}</dd>
               </div>
               <dt class="two-col">MTU</dt><dd class="four-col last-col">{$ vlanDetails.vlan.mtu $}</dd>
               <dt class="two-col">Fabric</dt><dd class="four-col last-col">{$ vlanDetails.fabric.name $}</dd>
               <dt class="two-col">Spaces</dt><dd class="four-col last-col"><span data-ng-repeat="space in vlanDetails.relatedSpaces"><a href="#/space/{$ space.id $}">{$ space.name $}</a> </span></dd>
           </dl>
            <dl class="six-col last-col">
                <dt class="two-col">DHCP</dt><dd class="four-col last-col">{$ vlanDetails.vlan.dhcp_on ? "Enabled" : "Disabled" $}</dd>
                <div class="ng-hide" data-ng-show="vlanDetails.primaryRack">
                    <dt class="two-col">Primary controller</dt><dd class="four-col last-col">{$ vlanDetails.primaryRack.hostname $}</dd>
                </div>
                <div class="ng-hide" data-ng-show="vlanDetails.secondaryRack">
                    <dt class="two-col">Secondary controller</dt><dd class="four-col last-col">{$ vlanDetails.secondaryRack.hostname $}</dd>
                </div>
                <dt class="two-col">Rack controllers</dt>
                <dd class="four-col last-col">
                    <span data-ng-repeat="rack in vlanDetails.relatedControllers">
                        <a href="#/node/controller/{$ rack.system_id $}" class="link--alt">{$ rack.hostname $}</a>
                    </span>
                </dd>
            </dl>
        </div>
    </section>
    <section class="row">
        <div class="inner-wrapper">
          <div class="twelve-col">
              <h2>Subnets on this VLAN</h2>
              <div class="table">
                  <header class="table__head">
                      <div class="table__row">
                          <div class="table__header table-col--60">Subnet</div>
                          <div class="table__header table-col--10">Used</div>
                          <div class="table__header table-col--30">Space</div>
                      </div>
                  </header>
                  <section class="table__body">
                      <div class="table__row" data-ng-repeat="row in vlanDetails.relatedSubnets">
                          <div class="table__data table-col--60"><a href="#/subnet/{$ row.subnet.id $}">{$ row.subnet.cidr $}</a></div>
                          <div class="table__data table-col--10">{$ row.subnet.statistics.usage_string $}</div>
                          <div class="table__data table-col--30"><a href="#space/{$ row.space.id $}">{$ row.space.name $}</a></div>
                      </div>
                  </section>
              </div>
          </div>
        </div>
    </section>
</div>
