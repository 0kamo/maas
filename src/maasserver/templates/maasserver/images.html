{% extends "maasserver/base.html" %}

{% block nav-active-images %}active{% endblock %}
{% block title %}Boot Images{% endblock %}
{% block page-title %}Boot Images in {% include "maasserver/site_title.html" %}{% endblock %}

{% block html_includes %}{% include "maasserver/snippets.html" %}
{% endblock %}

{% block head %}
  <style type="text/css">
    form li {
      margin-bottom: 2px;
    }
    .section {
      margin-bottom: 30px;
    }
    .section h2 {
      padding-bottom: 5px;
      border-bottom: 1px solid #e5e2e0;
    }
    .section .content {
      margin-left: 10px;
    }
    .images-warning {
      font-weight: bold;
      text-align: center;
      padding: 10px;
      border: 1px solid #dd4814;
      border-radius: 5px;
      -webkit-border-radius: 5px;
      background-color: rgba(221, 72, 20, 0.3);
    }
    .importing {
      margin: -20px auto -19px auto;
      width: 160px;
      font-weight: bold;
      text-align: center;
      padding: 10px;
      border-right: 1px solid rgba(221, 72, 20, 0.5);
      border-bottom: 1px solid rgba(221, 72, 20, 0.5);
      border-left: 1px solid rgba(221, 72, 20, 0.5);
      border-bottom-right-radius: 5px;
      -webkit-border-bottom-right-radius: 5px;
      border-bottom-left-radius: 5px;
      -webkit-border-bottom-right-radius: 5px;
      background-color: rgba(221, 72, 20, 0.2);
    }
    .importing-dot {
      opacity: 0;
      -webkit-animation: dot 1.3s infinite;
      animation: dot 1.3s infinite;
    }
    @-webkit-keyframes dot {
        0% {
            opacity: 0;
        }
        50% {
            opacity: 0;
        }
        100% {
            opacity: 1;
        }
    }
    @keyframes dot {
        0% {
            opacity: 0;
        }
        50% {
            opacity: 0;
        }
        100% {
            opacity: 1;
        }
    }
  </style>
{% endblock %}

{% block content %}
    {% if import_running %}
    <div class="importing">
      <div class="spinner spin"></div>
      Importing images
      <span class="importing-dot">.</span>
      <span class="importing-dot" style="-webkit-animation-delay: 0.2s; animation-delay: 0.2s;">.</span>
      <span class="importing-dot" style="-webkit-animation-delay: 0.3s; animation-delay: 0.3s;">.</span>​
    </div>
    {% endif %}
    <div id="ubuntu-images" class="section">
      <h2>Ubuntu</h2>
      <div class="content">
        <form id="ubuntu_images"
          method="POST"
          action="{% url 'images' %}">
          {% csrf_token %}
          <input type="hidden" name="ubuntu_images" value="1" />
          {% if user.is_superuser and not import_running %}
          <div class="row">
            {% if connection_error %}
            <div id="connection-error" class="images-warning">
              Connection Error: Unable to retrieve image information from
              boot sources.
            </div>
            {% else %}
            {% if ubuntu_streams_count == 0 %}
            <div id="no-ubuntu-sources" class="images-warning">
              Error: No boot sources provide Ubuntu images.
            </div>
            {% elif ubuntu_streams_count == 1 %}
            <div class="col2">
              <div class="space-bottom-small">Release:</div>
              <ul id="ubuntu-releases" class="data-list">
                {% for release in ubuntu_releases %}
                <li><input type="checkbox" name="release"
                  value="{{release.name}}"
                  {% if release.checked %}checked="checked"{% endif %}>
                  {{release.title}}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="col10 last">
              <div class="space-bottom-small">Architecture:</div>
              <ul id="ubuntu-arches" class="data-list">
                {% for arch in ubuntu_arches %}
                <li><input type="checkbox" name="arch"
                  value="{{arch.name}}"
                  {% if arch.checked %}checked="checked"{% endif %}>
                  {{arch.title}}</li>
                {% endfor %}
              </ul>
            </div>
            {% else %}
            <div id="too-many-ubuntu-sources" class="images-warning">
              More than one boot source is providing Ubuntu images. Image
              selection cannot be performed using the WebUI.
            </div>
            {% endif %}
            {% endif %}
          </div>
          <div class="clear"></div>
          {% endif %}
          <div class="row space-top">
            {% if ubuntu_resources|length %}
            <table id="ubuntu-resources" class="space-top list">
              <thead>
                <tr>
                  <th class="spinner-col"></th>
                  <th>Release</th>
                  <th>Architecture</th>
                  <th>Size</th>
                  <th>Nodes deployed</th>
                  <th>Last update</th>
                </tr>
              </thead>
              <tbody>
                {% for resource in ubuntu_resources %}
                <tr
                  class="{% cycle 'even' 'odd' %}"
                  data-id="{{ resource.id }}">
                  <td>
                    {% if not resource.complete %}
                    <div
                      title="{{ resource.status }}"
                      class="
                        spinner
                        {% if resource.downloading %}spin{% endif %}">
                    </div>
                    {% endif %}
                  </td>
                  <td>{{ resource.title }}</td>
                  <td>{{ resource.arch }}</td>
                  <td>{{ resource.size }}</td>
                  <td>{{ resource.number_of_nodes }}</td>
                  <td>{{ resource.last_update }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
            <div id="missing-ubuntu-images" class="images-warning">
              No Ubuntu images have been imported. Ubuntu images are required
              to allow nodes to enlist, commission, and install.</div>
            {% endif %}
          </div>
          <div class="clear"></div>
          <div class="row space-top">
            {% if user.is_superuser and not import_running %}
            <div class="col12 last align-right">
              {% if ubuntu_streams_count == 1 %}
              {% if ubuntu_resources|length %}
              <input type="submit" class="button" value="Apply Ubuntu changes">
              {% else %}
              <input type="submit" class="button" value="Import boot images">
              {% endif %}
              {% elif ubuntu_streams_count > 1 %}
              <input type="submit" class="button" value="Import boot images">
              {% endif %}
            </div>
            {% endif %}
          </div>
          <div class="clear"></div>
        </form>
      </div>
    </div>
{% endblock %}
