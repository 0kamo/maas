#!/bin/sh -e

# Only ask for new installations and reconfiguring.
# XXX Fix to not ask during new installations when upgrading from the old
# maas package or installing from the CD.
if ([ "$1" = "configure" ] && [ -z "$2" ]) || [ "$1" = "reconfigure" ]; then
    . /usr/share/debconf/confmodule

    db_get maas-cluster-controller/maas-url || true
    if [ -n "$RET" ]; then
        db_set maas-cluster-controller/maas-url "$RET"
    else
        # Attempt to pre-populate if installing on the region controller.
        if [ -e /etc/maas/maas_local_settings.py ]; then
            url=$(awk '$1 == "DEFAULT_MAAS_URL" { split($0,array,"\"")} END{print array[2] }' /etc/maas/maas_local_settings.py)
            db_set maas-cluster-controller/maas-url "$url"
        fi
    fi
    db_input high maas-cluster-controller/maas-url || true
    db_go
fi
#DEBHELPER#
